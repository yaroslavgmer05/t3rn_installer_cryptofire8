channel_logo() {
  echo -e '\033[0;32m'
  echo -e '‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê'
  echo -e '‚îÇ      üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –∫–∞–Ω–∞–ª CryptoFire8      ‚îÇ'
  echo -e '‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò'
  echo -e '\e[0m'
  echo -e "\nüî• –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ —Å–∞–º—ã–π üî• –∫–∞–Ω–∞–ª –≤ –∫—Ä–∏–ø—Ç–µ: @cryptofire8 [üöÄ]"
}
update_node() {
  delete_node

  if [ -d "$HOME/executor" ] || screen -list | grep -q "\.t3rnnode"; then
    echo '–ü–∞–ø–∫–∞ executor –∏–ª–∏ —Å–µ—Å—Å–∏—è t3rnnode —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –Ω–æ–¥—É –∏–ª–∏ –≤—ã–π—Ç–∏ –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞.'
    return
  fi

  echo '–ù–∞—á–∏–Ω–∞—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–¥—ã...'

  read -p "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á: " PRIVATE_KEY_LOCAL

  cd $HOME

  sudo wget https://github.com/t3rn/executor-release/releases/download/v0.38.0/executor-linux-v0.38.0.tar.gz -O executor-linux.tar.gz
  sudo tar -xzvf executor-linux.tar.gz
  sudo rm -rf executor-linux.tar.gz
  cd executor

  export NODE_ENV="testnet"
  export LOG_LEVEL="debug"
  export LOG_PRETTY="false"
  export EXECUTOR_PROCESS_ORDERS="true"
  export EXECUTOR_PROCESS_CLAIMS="true"
  export PRIVATE_KEY_LOCAL="$PRIVATE_KEY_LOCAL"
  export ENABLED_NETWORKS="arbitrum-sepolia,base-sepolia,optimism-sepolia,l1rn"
  export RPC_ENDPOINTS_BSSP="https://base-sepolia-rpc.publicnode.com"
  export RPC_ENDPOINTS_L1RN="https://brn.calderarpc.com/"
  export RPC_ENDPOINTS_ARBT="https://api.zan.top/arb-sepolia"
  export EXECUTOR_MAX_L3_GAS_PRICE=150
  export EXECUTOR_PROCESS_PENDING_ORDERS_FROM_API="false"

  cd $HOME/executor/executor/bin/

  screen -dmS t3rnnode bash -c '
    echo "–ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤ screen-—Å–µ—Å—Å–∏–∏"

    cd $HOME/executor/executor/bin/
    ./executor

    exec bash
  '

  echo "Screen —Å–µ—Å—Å–∏—è 't3rnnode' —Å–æ–∑–¥–∞–Ω–∞ –∏ –Ω–æ–¥–∞ –∑–∞–ø—É—â–µ–Ω–∞..."
}

download_node() {
  if [ -d "$HOME/executor" ] || screen -list | grep -q "\.t3rnnode"; then
    echo '–ü–∞–ø–∫–∞ executor –∏–ª–∏ —Å–µ—Å—Å–∏—è t3rnnode —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –Ω–æ–¥—É –∏–ª–∏ –≤—ã–π—Ç–∏ –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞.'
    return
  fi

  echo '–ù–∞—á–∏–Ω–∞—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–æ–¥—ã...'

  read -p "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á: " PRIVATE_KEY_LOCAL

  sudo apt update -y && sudo apt upgrade -y
  sudo apt-get install make screen build-essential software-properties-common curl git nano jq -y

  cd $HOME

  sudo wget https://github.com/t3rn/executor-release/releases/download/v0.38.0/executor-linux-v0.38.0.tar.gz -O executor-linux.tar.gz
  sudo tar -xzvf executor-linux.tar.gz
  sudo rm -rf executor-linux.tar.gz
  cd executor

  export NODE_ENV="testnet"
  export LOG_LEVEL="debug"
  export LOG_PRETTY="false"
  export EXECUTOR_PROCESS_ORDERS="true"
  export EXECUTOR_PROCESS_CLAIMS="true"
  export PRIVATE_KEY_LOCAL="$PRIVATE_KEY_LOCAL"
  export ENABLED_NETWORKS="arbitrum-sepolia,base-sepolia,optimism-sepolia,l1rn"
  export RPC_ENDPOINTS_BSSP="https://base-sepolia-rpc.publicnode.com"
  export RPC_ENDPOINTS_L1RN="https://brn.calderarpc.com/"
  export RPC_ENDPOINTS_ARBT="https://api.zan.top/arb-sepolia"
  export EXECUTOR_MAX_L3_GAS_PRICE=105
  export EXECUTOR_PROCESS_PENDING_ORDERS_FROM_API="false"

  cd $HOME/executor/executor/bin/

  screen -dmS t3rnnode bash -c '
    echo "–ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤ screen-—Å–µ—Å—Å–∏–∏"

    cd $HOME/executor/executor/bin/
    ./executor

    exec bash
  '

  echo "Screen —Å–µ—Å—Å–∏—è 't3rnnode' —Å–æ–∑–¥–∞–Ω–∞ –∏ –Ω–æ–¥–∞ –∑–∞–ø—É—â–µ–Ω–∞..."
}

check_logs() {
  if screen -list | grep -q "\.t3rnnode"; then
    screen -S t3rnnode -X hardcopy /tmp/screen_log.txt && sleep 0.1 && tail -n 100 /tmp/screen_log.txt && rm /tmp/screen_log.txt
  else
    echo "–°–µ—Å—Å–∏—è t3rnnode –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
  fi
}

change_fee() {
    echo '–ù–∞—á–∏–Ω–∞—é –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏...'

    if [ ! -d "$HOME/executor" ]; then
        echo '–ü–∞–ø–∫–∞ executor –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–¥—É.'
        return
    fi

    session="t3rnnode"

    read -p '–ù–∞ –∫–∞–∫–æ–π –≥–∞–∑ GWEI –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å? (–ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É 105) ' GWEI_SET

    if screen -list | grep -q "\.${session}"; then
      screen -S "${session}" -p 0 -X stuff "^C"
      sleep 1
      screen -S "${session}" -p 0 -X stuff "export EXECUTOR_MAX_L3_GAS_PRICE=$GWEI_SET\n"
      sleep 1
      screen -S "${session}" -p 0 -X stuff "./executor\n"
      echo '–ö–æ–º–∏—Å—Å–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞.'
    else
      echo "–°–µ—Å—Å–∏—è ${session} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ì–∞–∑ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å—Å—è"
      return
    fi
}

stop_node() {
  echo '–ù–∞—á–∏–Ω–∞—é –æ—Å—Ç–∞–Ω–æ–≤–∫—É...'

  if screen -list | grep -q "\.t3rnnode"; then
    screen -S t3rnnode -p 0 -X stuff "^C"
    echo "–ù–æ–¥–∞ –±—ã–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞."
  else
    echo "–°–µ—Å—Å–∏—è t3rnnode –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
  fi
}

auto_restart_node() {
  if screen -list | grep -q "\.t3rnnode_auto"; then
    sudo screen -X -S t3rnnode_auto quit
    echo '–£ –≤–∞—Å —É–∂–µ –±—ã–ª —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–∫—Ä–∏–Ω t3rnnode_auto. –û–Ω –±—ã–ª —É–¥–∞–ª–µ–Ω'
  else
    echo '–ù–∞—á–∏–Ω–∞—é –∑–∞–ø—É—Å–∫...'
  fi

  screen -dmS t3rnnode_auto bash -c '
    echo "–ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤ screen-—Å–µ—Å—Å–∏–∏"

    while true; do
      restart_node
      sleep 7200
    done

    exec bash
  '

  echo "Screen —Å–µ—Å—Å–∏—è 't3rnnode_auto' —Å–æ–∑–¥–∞–Ω–∞ –∏ –Ω–æ–¥–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞..."
}

restart_node() {
  echo '–ù–∞—á–∏–Ω–∞—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É...'

  session="t3rnnode"
  
  if screen -list | grep -q "\.${session}"; then
    screen -S "${session}" -p 0 -X stuff "^C"
    sleep 1
    screen -S "${session}" -p 0 -X stuff "./executor\n"
    echo "–ù–æ–¥–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞."
  else
    echo "–°–µ—Å—Å–∏—è ${session} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
  fi
}

delete_node() {
  echo '–ù–∞—á–∏–Ω–∞—é —É–¥–∞–ª–µ–Ω–∏–µ –Ω–æ–¥—ã...'

  if [ -d "$HOME/executor" ]; then
    sudo rm -rf $HOME/executor
    echo "–ü–∞–ø–∫–∞ executor –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞."
  else
    echo "–ü–∞–ø–∫–∞ executor –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
  fi

  if screen -list | grep -q "\.t3rnnode"; then
    sudo screen -X -S t3rnnode quit
    echo "–°–µ—Å—Å–∏—è t3rnnode –±—ã–ª–∞ –∑–∞–∫—Ä—ã—Ç–∞."
  else
    echo "–°–µ—Å—Å–∏—è t3rnnode –Ω–µ –Ω–∞–π–¥–µ–Ω–∞."
  fi

  sudo screen -X -S t3rnnode_auto quit

  echo "–ù–æ–¥–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞."
}

exit_from_script() {
  exit 0
}

while true; do
    channel_logo
    sleep 2
    echo -e "\n\n–ú–µ–Ω—é:"
    echo "1. üöÄ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–¥—É"
    echo "2. üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–æ–¥—ã"
    echo "3. üêæ –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–º–∏—Å—Å–∏—é"
    echo "4. üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–¥—É"
    echo "5. üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–¥—É"
    echo "6. üìà –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–¥—ã"
    echo "7. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–¥—É"
    echo "8. üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –Ω–æ–¥—É"
    echo -e "9. üö™ –í—ã–π—Ç–∏ –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞\n"
    read -p "–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –º–µ–Ω—é: " choice

    case $choice in
      1)
        download_node
        ;;
      2)
        check_logs
        ;;
      3)
        change_fee
        ;;
      4)
        stop_node
        ;;
      5)
        restart_node
        ;;
      6)
        auto_restart_node
        ;;
      7)
        update_node
        ;;
      8)
        delete_node
        ;;
      9)
        exit_from_script
        ;;
      *)
        echo "–ù–µ–≤–µ—Ä–Ω—ã–π –ø—É–Ω–∫—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ü–∏—Ñ—Ä—É –≤ –º–µ–Ω—é."
        ;;
    esac
  done

